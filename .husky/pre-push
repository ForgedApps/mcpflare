# Verify VSCode extension version is in sync with main package
echo "Verifying VSCode extension version sync..."
MAIN_VERSION=$(node -p "require('./package.json').version")
VSCODE_VERSION=$(node -p "require('./vscode-extension/package.json').version")
if [ "$MAIN_VERSION" != "$VSCODE_VERSION" ]; then
  echo "❌ ERROR: Version mismatch detected!"
  echo "   Main package.json version: $MAIN_VERSION"
  echo "   VSCode extension version: $VSCODE_VERSION"
  echo "   Please run: node scripts/sync-vscode-extension-version.js"
  exit 1
fi
echo "✅ VSCode extension version in sync: $MAIN_VERSION"

# Verify vscode-extension lock file is in sync
echo "Verifying vscode-extension lock file..."
(cd vscode-extension && npm ci --dry-run) 2>/dev/null || {
  echo "❌ ERROR: vscode-extension/package-lock.json out of sync!"
  echo "   Run: cd vscode-extension && npm install"
  exit 1
}
echo "✅ VSCode extension lock file in sync"

# Lint/format check before pushing (matches CI "npm run check")
# Note: biome check includes both lint and format checks
npm run check

# Run tests before pushing - tests MUST pass, do not skip or disable tests
# If tests fail, fix the underlying issue rather than bypassing this hook
echo "Running tests before push..."
npm run test

echo "✅ All checks passed - pushing to remote"
